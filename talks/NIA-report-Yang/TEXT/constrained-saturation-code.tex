\FOIL{Constrained saturation - basic idea}
\vfill

Constrained relational product: 
\LIST{
\BULL input: 
    \LIST{
    \CIRC MDD $a$ encoding a set of states in which the newly generated states are limited
    \CIRC MDD $s$ encoding a set of states
    \CIRC MDD $r$ encoding the trasition relation
    }
\BULL output:
MDD $t$ encoding a set of states which are the immediate successors of states in $s$ \emph{and} also in $a$.
}

\begin{equation*}
\bset(t) \!=\! \id{RelProd}(s,r) \cap \bset(a) \Longleftrightarrow
\bset(t[i']) \! = \!\! \bigcup_{\forall i, i' \in \sset_l} \!\!
[
\id{RelProd}(s[i],r[i][i'])
\cap \bset(a[i'])
],
\end{equation*}

\FPSCENTERWIDE{cons_saturate}{9cm}

\FOIL{Constrained saturation}
\vfill

\ALGORITHM{$mdd ~~ \id{ConsSaturate}(\{\nset^{-1}_{L}\cdots\nset^{-1}_{1}\}, mdd ~ a, mdd ~ s)$
\REMARK{$a$: the constraint; $s$: the set being saturated}
} {
\LISTING{0}{
\LL if $\id{InCache}_{\id{ConsSaturate}}(a,s,t)$ then return $t$;
\LL $level~l \ASSIGN s.\id{lvl}$; ~
    $mdd~t \ASSIGN \id{NewNode}(l)$; ~
    $mdd~r \ASSIGN \nset_{l}^{-1}$;
\LL foreach $i \in \sset_{l}$ s.t.\ $s[i]\neq\0$ do
\LPx if $a[i] \neq \0$ then
\label{line:case1}
      $t[i] \!\ASSIGN\! \id{ConsSaturate}(\{\nset^{-1}_{L}\cdots\nset^{-1}_{1}\}, a[i],s[i])$; ~
     else
      $t[i] \!\ASSIGN\! s[i]$;
\LL repeat
\LLx foreach $i,i' \in \sset_{l}$ s.t.\ $r[i][i']\!\neq\!\0$ do
\LPxx if $a[i'] \neq \0$ then
\label{line:case2}
\LLxxx $mdd~u \!\ASSIGN\! \id{ConsRelProd}(\{\nset^{-1}_{L}\cdots\nset^{-1}_{1}\}, a[i'],\!t[i],\!r[i][i'])$; ~
       $t[i'] \ASSIGN \id{Or}(t[i'],u)$;
\LL until $t$ does not change;
\LL $t \!\ASSIGN \!\!\id{UniqueTablePut}(t)$; ~
    $\id{CacheAdd}_{\id{ConsSaturate}}(a,s,t)$;
\LL return $t$;
}}
%
%\ALGORITHM{$mdd ~~ \id{ConsRelProd}(\{\nset^{-1}_{L}\cdots\nset^{-1}_{1}\}, mdd~ a, mdd ~ s, mdd ~ r)$} {
%\LISTING{0}{
%\LL if $s = \1$ and $r = \1$ then return $\1$;
%\LL if $\id{InCache}_{\id{ConsRelProd}}(a,s,r,t)$ then return $t$;
%\LL $level~l \ASSIGN s.\id{lvl}$; ~
%    $mdd~t \ASSIGN \0$;
%\LLx foreach $i,i' \in \sset_{l}$ s.t.\ $r[i][i']\!\neq\!\0$ do
%\LPxx if $a[i'] \neq \0$ then
%\label{line:check}
%\LPxxx $mdd~u \!\ASSIGN\! \id{ConsRelProd}(\{\nset^{-1}_{L}\cdots\nset^{-1}_{1}\}, a[i'],\!s[i],\!r[i][i'])$;
%\LPxxx if $u\neq \0$ then
%\LPxxxx if $t=\0$ then $t \ASSIGN \id{NewNode}(l)$;
%\LPxxxx $t[i'] \ASSIGN \id{Or}(t[i'],u)$;
%\LL $t \ASSIGN \id{ConsSaturate}(\{\nset^{-1}_{L}\cdots\nset^{-1}_{1}\}, a,\id{UniqueTablePut}(t))$; ~
%    $\id{CacheAdd}_{\id{ConsRelProd}}(a,s,r,t)$;
%\LL return $t$;
%}}

\vfill
\LIST{
\BULL We constrain the state exploration on-the-fly during the \STRESS{check-and-fire} step in Saturation.
\BULL The recursive calls have an additional parameter, an MDD node, to enforce the restriction to $a$.
\BULL Locality is not reduced.
}

\vfill
