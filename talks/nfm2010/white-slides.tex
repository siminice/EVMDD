% compile with pdflatex slides.tex

\documentclass{beamer}
\usepackage[utf8]{inputenc}

% \usepackage{pgfpages}
% \pgfpagesuselayout{4 on 1}[a4paper,landscape,border shrink=5mm]

\usepackage{graphicx}

\usepackage{color}

\usepackage{beamerthemeplain}
%\usetheme{progressbar}
%\progressbaroptions{headline=sections,frametitle=normal,titlepage=normal}

\usepackage{tikz}
\usetikzlibrary{shapes}
\usetikzlibrary{arrows,decorations.pathmorphing,backgrounds,positioning,fit}
\tikzset{terminal node/.style={circle, draw,
    rounded corners, shade, top color=white, bottom 
    color=blue!50!black!20, draw=blue!40!black!60, thick}}
\tikzset{mdd node/.style={terminal node, rectangle split, rectangle split horizontal, rectangle split parts=#1}}
\tikzset{regular edge/.style={draw=blue!40!black!60, thick}}
\tikzset{outgoing edge/.style={regular edge, very thin}}
\tikzset{comment/.style={blue!95}}
\tikzset{diagram background/.style={draw=example text.fg,fill=example text.fg!10!bg,rounded corners=0.2cm}}

\renewcommand{\O}{\mathrm{O}}
\newcommand{\Z}{\mathbb{Z}}

\title{Model checking with edge-valued decision diagrams}

\author{
  Pierre~Roux\inst{1}
  \and
  Radu~I.~Siminiceanu\inst{2}%%\\[3mm]
}

\institute{
\includegraphics[height=10mm]{ENS_Lyon_logo.png}~~~~~
\includegraphics[height=10mm]{NIA_logo.png}\\[2mm]
  Ã‰NS Lyon, France
  (\texttt{pierre.roux@ens-lyon.org})
  \and
  \vspace*{-3mm} NIA
  (\texttt{radu@nianet.org})%%\\[3mm]
}

\date{
\vspace*{5mm}
NASA Formal Methods Symposium\\ April 15, 2010
}

\everymath{\displaystyle}

%\includeonlyframes{current}

\begin{document}

\frame{
  \titlepage
}

\frame{\tableofcontents}

%% \AtBeginSection[] 
%% {
%% \begin{frame}<beamer>
%%   \tableofcontents[currentsection]
%% \end{frame}
%% }

\begin{frame}
  \frametitle{The State of Symbolic Model Checking Research}

\vfill
\begin{block}{Evolution and Impact of Decision Diagrams}
 \begin{itemize}
   \item Late 80s - early 90s: the wow factor, BDDs are (re)discovered
   \item Late 90s - early 00s: real progress
     \begin{itemize}
       \item Extensions, generalizations (MTBDDs, BMDs, EVMDDs, etc)
       \item New techniques (saturation, BMC, CEGAR, interpolation)
     \end{itemize} 
   \item Since then ...
      \begin{itemize}
        \item Interest has shifted to other areas (SAT/SMT solving)
        \item There are even rumors out there that symbolic MC has 
          entered a \emph{``Brezhnevian era''} (stagnation)
        \item Fact or fiction ?
      \end{itemize}
 \end{itemize}
\end{block}
\vfill

\end{frame}

\begin{frame}
  \frametitle{Purpose of this work}

\vfill
\begin{block}{Stagnation: fact or fiction?}
 \begin{itemize}
   \item A little bit of both
   \item New ideas exist, but are disparate
   \item Examples of untapped resources: 
     \begin{itemize}
       \item Edge-valued decision diagrams (EVMDD)
       \item Identity-reduced decision diagrams
       \item Hashing, caching, garbage collection
       \item Guided search heuristics
     \end{itemize}
 \end{itemize}
\end{block}

\vfill
 \begin{alertblock}{Our (declared) goal}
  \begin{center}
   Represent in one formalism (some of) the best techniques available at the moment
   across a spectrum of existing tools
  \end{center}
 \end{alertblock}
\vfill
\end{frame}

\section[BDD and MTBDD]{Decision Diagrams}

\begin{frame}
  \frametitle{Encoding of functions}
  \vspace{-1mm}
  The advent of symbolic MC: \emph{compact} representation of
  \begin{itemize}
  \item boolean functions $f: \left\{0, 1\right\}^n \rightarrow \left\{0, 1\right\}$
  \item sets $\left\{x \in \left\{0, 1\right\}^n \;|\; f(x) = 1\right\}$
  \end{itemize}

  Evolution:
  \begin{itemize}
  \item Truth table: \emph{$2^n$ entries}
  \item Binary Decision Diagram (BDD): merge common subtrees \\
    \emph{still exponential size in worst case, often better in practice}
    \vspace{2mm}
    \begin{tikzpicture}
      [xscale=0.5, yscale=1.1, auto]
      \node at (-8,1.5) {$\begin{array}{ccc|c}
          a & b & c & f(a, b, c) \\
          \hline
          0 & 0 & 0 & 0 \\
          0 & 0 & 1 & 1 \\
          0 & 1 & 0 & 0 \\
          0 & 1 & 1 & 1 \\
          1 & 0 & 0 & 1 \\
          1 & 0 & 1 & 0 \\
          1 & 1 & 0 & 0 \\
          1 & 1 & 1 & 1
        \end{array}$};
      \node [mdd node=3]    (l3n0)    at ( 0, 3) {$a$\nodepart{two}0\nodepart{three}1};
      \node [mdd node=3]    (l2n1)    at ( 2, 2) {$b$\nodepart{two}0\nodepart{three}1};
      \node [mdd node=3]    (l1n1)    at (-2, 1) {$c$\nodepart{two}0\nodepart{three}1};
      \node [mdd node=3]    (l1n2)    at ( 2, 1) {$c$\nodepart{two}0\nodepart{three}1};
      \node [terminal node] (bottom0) at (-2, 0) {0};
      \node [terminal node] (bottom1) at ( 2, 0) {1};
      
      \draw [regular edge]  (l3n0.two   |- l3n0.south) to (l1n1.north);
      \draw [regular edge]  (l3n0.three |- l3n0.south) to (l2n1.north);
      \draw [regular edge]  (l2n1.two   |- l2n1.south) to (l1n2.north);
      \draw [regular edge]  (l2n1.three |- l2n1.south) to (l1n1.north);
      \draw [regular edge]  (l1n1.two   |- l1n1.south) to (bottom0);
      \draw [regular edge]  (l1n1.three |- l1n1.south) to (bottom1);
      \draw [regular edge]  (l1n2.two   |- l1n2.south) to (bottom1);
      \draw [regular edge]  (l1n2.three |- l1n2.south) to (bottom0);
    \end{tikzpicture}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Integer/arithmetic functions}
  \begin{itemize}
  \item $f : \left\{0, 1\right\}^n \rightarrow \alert{\Z}$
  \item Extend BDD to \emph{Multi-Terminal BDD (MTBDD)}
    {\normalsize
    \begin{center}
      \begin{figure}
        \begin{tikzpicture}[yscale=0.85]
          \node [mdd node=3]    (l3n0)    at ( 0, 2) {$a$\nodepart{two}0\nodepart{three}1};
          \node [mdd node=3]    (l2n0)    at (-2, 1) {$b$\nodepart{two}0\nodepart{three}1};
          \node [mdd node=3]    (l2n1)    at ( 2, 1) {$b$\nodepart{two}0\nodepart{three}1};
          \node [terminal node] (bottom0) at (-3, 0) {0};
          \node [terminal node] (bottom1) at (-1, 0) {1};
          \node [terminal node] (bottom2) at ( 1, 0) {2};
          \node [terminal node] (bottom3) at ( 3, 0) {3};
          
          \draw [regular edge]  (l3n0.two   |- l3n0.south) to (l2n0.north);
          \draw [regular edge]  (l3n0.three |- l3n0.south) to (l2n1.north);
          \draw [regular edge]  (l2n0.two   |- l2n0.south) to (bottom0);
          \draw [regular edge]  (l2n0.three |- l2n0.south) to (bottom1);
          \draw [regular edge]  (l2n1.two   |- l2n1.south) to (bottom2);
          \draw [regular edge]  (l2n1.three |- l2n1.south) to (bottom3);
        \end{tikzpicture}
        \vspace{-3mm}
        \caption{$f : (a, b) \mapsto 2a+b$}
      \end{figure}
    \end{center}}
  \item Inefficient if $\mathrm{Img}\left(f\right)$ is large: less chances to share subtrees
  \end{itemize}
  Examples of other forms of DDs:
  \begin{itemize}
  \item Multiway DDs (MDD): $f : \alert{\left\{0, \ldots, k_1\right\} \times \cdots \times \left\{0, \ldots, k_n\right\}} \rightarrow \left\{0, 1\right\}$
  \item Binary Moment Diagrams (BMD): \\
     $\rightarrow$ work well for multipliers, but not much else
  \end{itemize}
\end{frame}

\section{EVMDDs}

\begin{frame}
  \frametitle{Edge Valued MDDs (EVMDDs)}
  \vfill
  \begin{itemize}
  \item EVBDDs introduced in 1992, but not sufficiently exploited \\
    ~$\Rightarrow$ (\textit{Reed-M\"{u}ller spectrum !?!})
    \vfill
  \item From MTBDDs to EVMDDs: \\ 
    merge all terminals ($0$) and assign (integer) values to edges
  \begin{center}
    \hspace{-6mm}
    \begin{tikzpicture}
      [xscale=0.8, yscale=1.5, auto]
      \begin{scope}
        \node [mdd node=3]    (l3n0)    at ( 0, 2) {$a$\nodepart{two}0\nodepart{three}1};
        \node [mdd node=3]    (l2n0)    at (-2, 1) {$b$\nodepart{two}0\nodepart{three}1};
        \node [mdd node=3]    (l2n1)    at ( 2, 1) {$b$\nodepart{two}0\nodepart{three}1};
        \node [terminal node] (bottom0) at (-3, 0) {0};
        \node [terminal node] (bottom1) at (-1, 0) {1};
        \node [terminal node] (bottom2) at ( 1, 0) {2};
        \node [terminal node] (bottom3) at ( 3, 0) {3};
        
        \draw [regular edge]  (l3n0.two   |- l3n0.south) to (l2n0.north);
        \draw [regular edge]  (l3n0.three |- l3n0.south) to (l2n1.north);
        \draw [regular edge]  (l2n0.two   |- l2n0.south) to (bottom0);
        \draw [regular edge]  (l2n0.three |- l2n0.south) to (bottom1);
        \draw [regular edge]  (l2n1.two   |- l2n1.south) to (bottom2);
        \draw [regular edge]  (l2n1.three |- l2n1.south) to (bottom3);
      \end{scope}
      
      \begin{scope}[xshift=7cm]
        \node [mdd node=3]    (l3n0')   at (0, 2) {$a$\nodepart{two}0\nodepart{three}1};
        \node [mdd node=3]    (l2n0')   at (0, 1) {$b$\nodepart{two}0\nodepart{three}1};
        \node [terminal node] (bottom') at (0, 0) {0};
        
        \draw [regular edge]  (l3n0'.two   |- l3n0'.south) to node [yshift=3mm,swap] {0} (l2n0'.north);
        \draw [regular edge]  (l3n0'.three |- l3n0'.south) to node [yshift=3mm]      {2} (l2n0'.north);
        \draw [regular edge]  (l2n0'.two   |- l2n0'.south) to node [yshift=3mm,swap] {0} (bottom');
        \draw [regular edge]  (l2n0'.three |- l2n0'.south) to node [yshift=3mm]      {1} (bottom');
      \end{scope}

      \begin{pgfonlayer}{background}
        \node [xscale=0.85,yscale=1.5] (r1) [diagram background, fit=(l3n0)(l2n0)(l2n1)(bottom0)(bottom1)(bottom2)(bottom3)] {};
        \node [xscale=0.9,yscale=1.5] (r2) [diagram background, fit=(l3n0')(l2n0')(bottom')] {};
      \end{pgfonlayer}
          
      \draw [shorten >=1mm,-to,thick,decorate,
      decoration={snake,amplitude=.4mm,segment length=2mm,
        pre=moveto,pre length=1mm,post length=2mm}]
      (r1) -- (r2);
    \end{tikzpicture}
  \end{center}
  \item 
  Value of $f$: composition of edge-values (e.g. addition, $+$)\\
  along the path from root to terminal node
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{EVMDD characteristics}
  \begin{itemize}
  \item EVMDD encoding is smaller than MTBDDs ($\#$ nodes)
    \begin{itemize}
      \item [$\Rightarrow$] proved in this paper
    \end{itemize}
  \item Size can be linear instead of exponential (e.g. linear functions)
  \item Composition $\Rightarrow$  a generic algorithm for all binary operators:\\
    ~~~ for $f$, $g$ encoded by EVMDDs of size $|f|$ and $|g|$\\
    ~~~ $f\otimes g$ computed in $\O\left(|f|\,|g|\,|\mathrm{Img}(f)|\,|\mathrm{Img}(g)|\right)$
  \item The algorithm has \emph{exactly the same complexity}\\
    as its equivalent for MTBDDs, hence\\
    \alert{no gain} in (worst-case) time complexity
  \item Is there room for improvement ?
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{EV$^+$MDD algorithms}
  Yes, for following operations:
  \begin{itemize}
%%  \item Adding constant:\\
%%    $f+c$ computed in $\O(1)$
  \item Addition:\\
    $f+g$ computed in $\O\left(|f|\cdot|g|\right)$ \\
    (actually better with QEV$^+$MDDs)
  \item Relational operators:\\
    $f \triangleleft c$ computed in $\O\left(c\cdot|f|\right)$ \\
    $f \triangleleft g$ computed in $\O\left(|f|\cdot|g|\right)$ \\
%%  \item Multiplication by constant, min, max:\\
%%    computed in $\O(|f|)$
  \item Multiplication:\\
    $f\times g$ computed in $\O\left(|f|^2 \cdot |g|^2 \cdot |f\times g|\right)$
    \begin{itemize}
    \item exponential in worst case
    \item much better in many ``practical'' cases
    \end{itemize}
  \item Remainder and Euclidean division by constant:\\
    $f/c$ and $f\%c$ computed in $\O(c\cdot|f|)$
  \end{itemize}
\end{frame}

\section{Implementation}

%% NB: \verb does not normally work with colors
%% it works if you define a macro outside the frame
\defverb\evmddurl|http://research.nianet.org/~radu/evmdd/|

\begin{frame}[containsverbatim]{An EVMDD-based Model Checker}

  We have developed an EVMDD library featuring:
  \begin{itemize}
  \item EVMDDs for arithmetic expressions
  \item (Regular) MDDs for boolean expressions
  \item Identity-reduced encoding of transition relations
  \item Saturation-based state space construction
  \item Unsophisticated (i.e. fast) garbage collector (mark \& sweep)
  \end{itemize}
  
  \vfill 

  Some stats:
  \begin{itemize}
  \item 7 kLOC of ANSI C : library
  \item 4 kLOC : model checking front-end
  \end{itemize}

  \vfill
  \begin{center}
    \begin{block}{}
      Available at \alert{\evmddurl}
    \end{block}
  \end{center}
\end{frame}

\begin{frame}
  \frametitle{Results}

  Building state space vs CUDD (BFS) and SMART (saturation)
  \vspace{-3.7mm}
  \begin{center}
    \begin{tabular}{|l|r||r||r|r|r|}
      \hline
      {\footnotesize Model} & \multicolumn{1}{|c||}{\footnotesize Model} & \multicolumn{1}{c||}{\footnotesize Reachable} & {\footnotesize CUDD} & {\footnotesize SMART} & {\footnotesize EVMDD} \\
      & \multicolumn{1}{|c||}{\footnotesize size}  & \multicolumn{1}{c||}{\footnotesize states}  & {\footnotesize (sec)} & {\footnotesize (sec)} & {\footnotesize (sec)} \\
      \hline
      \hline
      {\footnotesize Dining} & 100 & $4\times10^{62}$ &   11.42 &    1.49 &    0.03 \\
      {\footnotesize philosophers} & 200 & $2\times10^{125}$ & 3054.69 &    3.03 &    0.07 \\
      & 15000 & $2\times10^{9404}$ &   --- &   --- &  195.29 \\
      \hline
      \hline
      {\footnotesize Round robin} & 40 & $9\times10^{13}$ &    4.44 &    0.44 &    0.08 \\
      {\footnotesize mutual exclusion} & 100 & $2\times10^{32}$ &   --- &    2.84 &    1.17 \\
      {\footnotesize protocol} & 200 & $7\times10^{62}$ &   --- &   20.02 &    9.14 \\
      \hline
      \hline
      {\footnotesize Slotted ring} & 10 & $8\times10^{9}$   &  1.16 &    0.19 &    0.01 \\
      {\footnotesize protocol}     & 20 & $2\times10^{20}$  &   --- &    0.71 &    0.04 \\
      {\footnotesize}             & 200 & $8\times10^{211}$ &   --- &  412.27 &   25.97 \\
      \hline
    \end{tabular}
    On Intel~Core~2, 1.2GHz, 1.5GB mem (``---'' means ``$>1$h'').
  \end{center}

\end{frame}

\begin{frame}
  \frametitle{Results}

  Building state space vs CUDD (BFS) and SMART (saturation)
  \begin{center}
    \begin{tabular}{|l|r||r||r|r|r|r|}
      \hline
      {\footnotesize Model} & \multicolumn{1}{|c||}{\footnotesize Model} & \multicolumn{1}{c||}{\footnotesize Reachable} & {\footnotesize CUDD} & {\footnotesize SMART} & {\footnotesize EVMDD} \\
      & \multicolumn{1}{|c||}{\footnotesize size}  & \multicolumn{1}{c||}{\footnotesize states}  & {\footnotesize (sec)} & {\footnotesize (sec)} & {\footnotesize (sec)} \\
      \hline
      \hline
      {\footnotesize Kanban} & 15 & $4\times10^{10}$ &   80.43 &    3.41 &    0.01 \\
      {\footnotesize assembly line} & 20 & $8\times10^{11}$ & 2071.58 &    8.23 &    0.02 \\
      & 400 & $6\times10^{25}$ &   --- &   --- &   74.89 \\
      \hline
      \hline
      {\footnotesize Knights} & 5 & $6\times10^{7}$ & 1024.42 &    5.29 &    0.27 \\
      {\footnotesize problem} & 7 & $1\times10^{15}$ &   --- &  167.41 &    3.46 \\
      & 9 & $8\times10^{24}$ &   --- &   --- &   32.20 \\
      \hline
      \hline
      {\footnotesize Randomized} & 6 & $2\times10^{6}$ &   4.22 &    8.42 &    0.86 \\
      {\footnotesize leader election} & 9 & $5\times10^{9}$ &   --- &  954.81 &   18.89 \\
      {\footnotesize protocol} & 11 & $9\times10^{11}$ &   --- &   --- &  109.25 \\
      \hline
    \end{tabular}
    On Intel~Core~2, 1.2GHz, 1.5GB mem (``---'' means ``$>1$h'').
  \end{center}
\end{frame}

\appendix

% EVMDD can be dramatically more efficient than ADD
% % cd evmdd_smc
% % src/evmdd-smc -v --cudd < examples/test0
% % src/evmdd-smc -v < examples/test0
% % src/evmdd-smc -v < examples/test2

% % cd examples
% % sal-deadlock-checker -v 2 -io p40.ord phil system
% % ./genphils -p 40 | ../src/evmdd-smc -q
% % ./genphils -p 1000 | ../src/evmdd-smc -q
% % ./genphils -p 4000 | ../src/evmdd-smc -q

\begin{frame}
  \frametitle{Questions}

  \begin{center}
    {\Huge ?}
  \end{center}
\end{frame}

\end{document}
